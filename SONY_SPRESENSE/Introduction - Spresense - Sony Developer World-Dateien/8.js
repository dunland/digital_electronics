(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(35),o=_(n(0)),l=_(n(2)),i=n(802),u=n(283),c=n(23),s=_(n(28)),f=_(n(29)),d=_(n(36)),p=_(n(51)),h=_(n(189)),E=_(n(44)),m=_(n(124)),v=n(279),w=_(n(190));function _(e){return e&&e.__esModule?e:{default:e}}function D(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var l=t[r](o),i=l.value}catch(e){return void n(e)}if(!l.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}("next")})}}n(800);var g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={showEula:!1,captcha:null,captchaExecuted:!1,modalContent:{title:"",message:""},modalOpen:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default.Component),a(t,[{key:"closeModal",value:function(){this.setState({modalOpen:!1})}},{key:"componentWillMount",value:function(){var e=this.props.fileDownload;(0,c.shouldFetch)(e,this.props.match.params.slug)&&this.context.registerFetchAction((0,i.fetchFileDownload)(this.props.match.params.slug))}},{key:"componentWillReceiveProps",value:function(e){var t=e.fileDownload;(0,c.shouldFetch)(t,e.match.params.slug)&&(0,i.fetchFileDownload)(e.match.params.slug)(e.dispatch,this.context.store.getState()),t.downloadLink&&(this.setState({showEula:!1},function(){var n=e.fileDownload.content.download_file.filename;(0,u.setDataLayer)({event:"file-download",file:n,eula:!!e.eula})(e.dispatch),location.href=t.downloadLink}),(0,i.resetDownloadLink)(e.match.params.slug)(e.dispatch))}},{key:"handleDownloadPress",value:function(){var e=this.props.fileDownload,t=e.content;t&&t.has_eula?this.setState({showEula:!0}):e.content.skip_captcha?(0,i.fetchDownloadLink)(this.props.match.params.slug,null)(this.props.dispatch,this.context.store.getState()):(this.captcha.execute(),this.setState({captchaExecuted:!0}))}},{key:"handleRejectEula",value:function(){this.setState({showEula:!1})}},{key:"handleAcceptEula",value:function(){var e=D(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showEula:!1}),this.props.fileDownload.content.skip_captcha?this.getDownloadLink():(this.captcha.execute(),this.setState({captchaExecuted:!0}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getDownloadLink",value:function(){var e=D(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.captcha,this.setState({captcha:null,captchaExecuted:!1}),e.prev=2,e.next=5,(0,i.fetchDownloadLink)(this.props.match.params.slug,t)(this.props.dispatch,this.context.store.getState());case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),n="captcha-not-verified"===e.t0.errorMessage?this.context.localize(e.t0.errorMessage):this.props.generalSubmitErrorMessage,this.setState({modalOpen:!0,modalContent:{title:this.context.localize("form-error-label"),message:n}});case 11:case"end":return e.stop()}},e,this,[[2,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"renderDownloadButton",value:function(){return o.default.createElement(f.default,{size:"small",className:"file-download--download-button",onClick:this.handleDownloadPress.bind(this)},"Download now")}},{key:"onCaptchaChange",value:function(e){var t=this;this.setState({captcha:e},function(){t.state.captchaExecuted&&e&&t.getDownloadLink()})}},{key:"getDialog",value:function(){var e=this.state,t=e.modalContent,n=e.modalOpen;return o.default.createElement(m.default,{open:n,dialogActions:[o.default.createElement(f.default,{onClick:this.closeModal.bind(this)},this.context.localize("continue"))],title:t.title,content:t.message,handleRequestClose:this.closeModal.bind(this)})}},{key:"getEulaDialog",value:function(e){if(!e)return null;var t=o.default.createElement("div",null,o.default.createElement(E.default,{noPadding:!0},e.content.post_content)),n=[o.default.createElement(f.default,{onClick:this.handleAcceptEula.bind(this),size:"small",key:"accept"},"Accept"),o.default.createElement(f.default,{onClick:this.handleRejectEula.bind(this),size:"small",key:"reject"},"Reject")];return o.default.createElement(m.default,{open:this.state.showEula,title:e.content.post_title,handleRequestClose:this.handleRejectEula.bind(this),dialogActions:n,content:t,scroll:!0})}},{key:"render",value:function(){var e=this,t=this.props,n=t.fileDownload,a=t.eula;if((0,v.loadingOrErrorCheck)(n,"content"))return o.default.createElement(v.LoadingAndError,{item:n,contentKey:"content"});var r=this.getEulaDialog(a),l=n.content;return o.default.createElement("div",{className:"file-download"},o.default.createElement(h.default,null),o.default.createElement("div",{className:"file-download--content"},o.default.createElement(d.default,null,o.default.createElement(p.default,{width:"1/1",viewport:this.props.viewport},o.default.createElement(s.default,{tag:1},l.post_title),o.default.createElement("div",{className:"file-download--metadata"},o.default.createElement("span",{className:"file-download--metadata--date"},l.post_date),o.default.createElement("span",{className:"file-download--metadata--size"}," | ",l.download_file.filesize)),o.default.createElement("div",{className:"file-download--metadata"},o.default.createElement("span",{className:"file-download--metadata--filename"},l.download_file.filename)),o.default.createElement(E.default,{noPadding:!0},l.post_content),this.renderDownloadButton(),n.content.skip_captcha?null:o.default.createElement(w.default,{onCheck:this.onCaptchaChange.bind(this),siteKey:this.props.captchaKey,ref:function(t){e.captcha=t}}),r,this.getDialog()))))}}]),t}();g.propTypes={fileDownload:l.default.object,eula:l.default.object,match:l.default.object,dispatch:l.default.func,viewport:l.default.object,captchaKey:l.default.string},g.contextTypes={store:l.default.object,registerFetchAction:l.default.func,localize:l.default.func};var O=(0,r.connect)(function(e,t){return{fileDownload:e.fileDownloads.list[t.match.params.slug],eula:e.eulas.list[t.match.params.slug],viewport:e.viewport,captchaKey:e.settings.captchaKey}},function(e){return{dispatch:e}})(g);t.default=O},800:function(e,t){},801:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EULA_NOT_FOUND=t.ACTIVATE_EULA=t.RECEIVE_EULA=t.REQUEST_EULA=void 0,t.requestEula=u,t.activateEula=c,t.receivedEula=s,t.notFound=f,t.fetchEula=function(e){return t=regeneratorRuntime.mark(function t(n,r,o){var l,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(l=r.settings.apiUrl+"/eulas/"+e,!r.eulas.list[e]||!r.eulas.list[e].loading){t.next=3;break}return t.abrupt("return",!0);case 3:if(n(u(e)),!r.eulas.list[e]){t.next=6;break}return t.abrupt("return",n(c(e)));case 6:return t.prev=6,t.next=9,(0,a.fetchResource)(l,o);case 9:return i=t.sent,n(s(e,i)),t.abrupt("return",Promise.resolve());case 14:throw t.prev=14,t.t0=t.catch(6),n(f(e)),t.t0;case 18:case"end":return t.stop()}},t,this,[[6,14]])}),n=function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function a(r,o){try{var l=e[r](o),i=l.value}catch(e){return void n(e)}if(!l.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});t(i)}("next")})},function(e,t,a){return n.apply(this,arguments)};var t,n};var a=n(23),r=t.REQUEST_EULA="REQUEST_EULA",o=t.RECEIVE_EULA="RECEIVE_EULA",l=t.ACTIVATE_EULA="ACTIVATE_EULA",i=t.EULA_NOT_FOUND="EULA_NOT_FOUND";function u(e){return{type:r,slug:e}}function c(e){return{type:l,slug:e}}function s(e,t){return{type:o,slug:e,payload:t}}function f(e){return{type:i,slug:e}}},802:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_DOWNLOAD_CAPTCHA_ERROR=t.RESET_DOWNLOAD_LINK=t.RECEIVE_DOWNLOAD_LINK=t.FILE_DOWNLOAD_NOT_FOUND=t.ACTIVATE_FILE_DOWNLOAD=t.RECEIVE_FILE_DOWNLOAD=t.REQUEST_FILE_DOWNLOAD=void 0,t.fetchFileDownload=function(e){return t=l(regeneratorRuntime.mark(function t(n,l,i){var u,c,s,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=l.settings.apiUrl+"/file/download/"+e,!l.fileDownloads.list[e]||!l.fileDownloads.list[e].loading){t.next=3;break}return t.abrupt("return",!0);case 3:if(n(h(e)),n((0,o.clearTitle)()),!l.fileDownloads.list[e]){t.next=8;break}return n((0,o.setTitle)(l.fileDownloads.list[e].post_title,0)),t.abrupt("return",n(E(e)));case 8:return t.prev=8,t.next=11,(0,a.fetchResource)(u,i);case 11:return c=t.sent,s=c.fileDownload,n((0,o.setTitle)(s.post_title,0)),n(m(e,s)),(f=!!s&&s.eula)&&(l.eulas.list[f]?n((0,r.activateEula)(f)):f&&c.eula?n((0,r.receivedEula)(e,c.eula)):n((0,r.notFound)(e))),t.abrupt("return",Promise.resolve());case 20:t.prev=20,t.t0=t.catch(8),n(v(e,t.t0));case 23:case"end":return t.stop()}},t,this,[[8,20]])})),function(e,n,a){return t.apply(this,arguments)};var t},t.fetchDownloadLink=function(e,t){return n=l(regeneratorRuntime.mark(function n(r,o,l){var i,u;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=o.settings.apiUrl+"/file/download-link/"+e+"?captcha="+t,r(h(e)),n.prev=2,n.next=5,(0,a.fetchResource)(i,l);case 5:return u=n.sent,r(_(e,u.fileDownloadLink)),n.abrupt("return",Promise.resolve(u));case 10:if(n.prev=10,n.t0=n.catch(2),"captcha-not-verified"!==n.t0.errorMessage){n.next=15;break}throw r(w(e,n.t0)),n.t0;case 15:r(v(e,n.t0));case 16:case"end":return n.stop()}},n,this,[[2,10]])})),function(e,t,a){return n.apply(this,arguments)};var n},t.resetDownloadLink=function(e){return function(t){t({type:d,slug:e})}};var a=n(23),r=n(801),o=n(93);function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var l=t[r](o),i=l.value}catch(e){return void n(e)}if(!l.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}("next")})}}var i=t.REQUEST_FILE_DOWNLOAD="REQUEST_FILE_DOWNLOAD",u=t.RECEIVE_FILE_DOWNLOAD="RECEIVE_FILE_DOWNLOAD",c=t.ACTIVATE_FILE_DOWNLOAD="ACTIVATE_FILE_DOWNLOAD",s=t.FILE_DOWNLOAD_NOT_FOUND="FILE_DOWNLOAD_NOT_FOUND",f=t.RECEIVE_DOWNLOAD_LINK="RECEIVE_DOWNLOAD_LINK",d=t.RESET_DOWNLOAD_LINK="RESET_DOWNLOAD_LINK",p=t.FILE_DOWNLOAD_CAPTCHA_ERROR="FILE_DOWNLOAD_CAPTCHA_ERROR";function h(e){return{type:i,slug:e}}function E(e){return{type:c,slug:e}}function m(e,t){return{type:u,slug:e,payload:t}}function v(e,t){return{type:s,slug:e,err:t}}function w(e,t){return{type:p,slug:e,err:t}}function _(e,t){return{type:f,slug:e,link:t}}}}]);